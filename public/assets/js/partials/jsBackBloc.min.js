$(document).ready(function(){formulaireTemporaire="";idBlocPartage=0;var lazyLoadInstance=new LazyLoad;calculCol=function(elem){if(elem.closest(".blocsEnfants").length>0){largeurColonne=elem.closest(".blocsEnfants").width()/12}else{largeurColonne=$(".conteneurBlocs > .dndBlocs").width()/12}largeur=elem.width();largeurElement=Math.round(largeur/largeurColonne);if(largeurElement>12){largeurElement=12}elem.attr("style","");elem.removeClass("col12 col11 col10 col9 col8 col7 col6 col5 col4 col3 col2 col1").addClass("col"+largeurElement);elem.children("div").children(".bloc-optionsAffichage").find('input[name$="[largeur]"]').val("col"+largeurElement)};options={handle:".drag",connectWith:".dndBlocs",placeholder:"dndPlaceholder",forcePlaceholderSize:true,cursorAt:{right:10,top:10},update:function(event,ui){$(".field-bloc").each(function(){$(this).find("input[id$='position']").val($(this).index());saveCloseFormulaire()});tinymce.remove();tinymce.init(optionsTinyMCEParagraphe);tinymce.init(optionsTinyMCE);lazyLoadInstance.update();entite=$("#main > form").attr("name");ancienParent=ui.sender;bloc=ui.item;if(ancienParent){ancienId=ancienParent.attr("id")+"_"+bloc.data("name");ancienName=entite+"["+ancienId.replace(entite+"_","").replace(/_/g,"][")+"]";nouveauCount=0;while(bloc.siblings('[data-name="'+nouveauCount+'"]').length>0){nouveauCount++}nouvelId=bloc.closest("[data-prototype]").attr("id")+"_"+nouveauCount;nouveauName=entite+"["+nouvelId.replace(entite+"_","").replace(/_/g,"][")+"]";bloc.find("[id]").each(function(){$(this).attr("id",$(this).attr("id").replace(ancienId,nouvelId))});bloc.find("[name]").each(function(){$(this).attr("name",$(this).attr("name").replace(ancienName,nouveauName))});bloc.attr("data-name",nouveauCount)}},start:function(event,ui){$(".dndBlocs").addClass("dndEnCours");ui.placeholder.attr("class","dndPlaceholder "+ui.item.attr("class")).removeClass("field-bloc form-group bloc-section");if(!ui.item.hasClass("listeBlocsDnD-bloc")){ui.placeholder.css("width",ui.item.width())}var marginsToSet=ui.item.data().sortableItem.margins;ui.item.css("margin-left",marginsToSet.left);ui.item.css("margin-top",marginsToSet.top)},stop:function(event,ui){$(".dndBlocs").removeClass("dndEnCours");bloc=ui.item;bloc.attr("style","");optionsAffichage=bloc.children("div").children(".bloc-optionsAffichage");conteneurPleineLargeur=optionsAffichage.find('input[name$="[pleineLargeur]"]').closest(".form-group");if(bloc.closest(".blocsEnfants").length>0){conteneurPleineLargeur.addClass("hidden");optionsAffichage.find('input[name$="[pleineLargeur]"]').prop("checked",false);bloc.removeClass("pleineLargeur")}else{conteneurPleineLargeur.removeClass("hidden")}if(!ui.item.hasClass("listeBlocsDnD-bloc")){ui.item.css("width",ui.placeholder.css("width"));calculCol(bloc)}}};$("#page_active_blocs").sortable(options);$("#region_blocs").sortable(options);$("div[id$='blocsEnfants']").sortable(options);optionsResizable={handles:"w, e",alsoResize:"#mirror",autoHide:true,start:function(event,ui){if(ui.element.closest(".blocsEnfants").length>0){largeurColonne=ui.element.closest(".blocsEnfants").width()/12}else{largeurColonne=$(".conteneurBlocs > .dndBlocs").width()/12}ui.element.resizable("option","grid",[largeurColonne,10])},stop:function(event,ui){saveCloseFormulaire();calculCol(ui.element)}};$(".field-bloc").resizable(optionsResizable).resizable("option","maxWidth",992);$(".pleineLargeur").resizable("option","disabled",true);$(".pleineLargeur .field-bloc").resizable(optionsResizable).resizable("option","maxWidth",null);if($("body").hasClass("new-page_active")||$("body").hasClass("edit-page_active")){listeBlocs="#page_active_blocs"}else if($("body").hasClass("new-region")||$("body").hasClass("edit-region")){listeBlocs="#region_blocs"}else{listeBlocs="div[id$='blocsEnfants']"}$(".listeBlocsDnD-bloc").draggable({connectToSortable:listeBlocs,helper:"clone",appendTo:"body",stop:function(event,ui){$(listeBlocs).find(".listeBlocsDnD-bloc").each(function(){type=$(this).data("type");$(this).addClass("chargement");if(type==="BlocPartage"){$("#ajoutBlocPartage").fadeIn("slow",function(){$("#ajoutBlocPartage").css({display:"flex",opacity:1})});idBlocPartage=$(this).data("bloc")}else{ajoutBloc(type,null)}})}});$(".bloc-slider div[id$='contenu_Slide']").sortable({handle:".dragSlide",update:function(event,ui){$(".field-slide").each(function(){$(this).find("input[id$='position']").val($(this).index());saveCloseFormulaire()})}});$(".bloc-galerie div[id$='contenu_images']").sortable({handle:".dragGalerie",update:function(event,ui){$(".field-galerie_image").each(function(){$(this).find("input[id$='position']").val($(this).index());saveCloseFormulaire()})}});$(".bloc-formulaire div[id$='contenu_champs']").sortable({handle:".dragChamp",update:function(event,ui){$(".field-champ").each(function(){$(this).find("input[id$='position']").val($(this).index());saveCloseFormulaire()})}});$(".bloc-grille div[id$='contenu_cases']").sortable({handle:".dragCase",update:function(event,ui){$(".field-case").each(function(){$(this).find("input[id$='position']").val($(this).index());saveCloseFormulaire()})}});var optionsSortableAccordeon={handle:".dragSection",update:function(event,ui){$(".field-section").each(function(){$(this).find("input[id$='position']").val($(this).index());saveCloseFormulaire()});tinymce.remove();tinymce.init(optionsTinyMCE)}};var sortableAccordeon=$(".bloc-accordeon div[id$='contenu_sections']");sortableAccordeon.sortable(optionsSortableAccordeon);$("form").on("click",".bloc-accordeon .field-collection-action a",function(){sortableAccordeon.sortable(optionsSortableAccordeon);sortableAccordeon.sortable("refresh")});$("form").on("click",".bloc-menu",function(e){e.stopPropagation();$(".bloc-menu").not(this).closest(".bloc-barreActions").removeClass("actif");$(this).closest(".bloc-barreActions").toggleClass("actif");$(this).closest("div").find(".suppressionBloc").hide()});$("body").on("click",function(){$(".bloc-barreActions").removeClass("actif");$(".suppressionBloc").hide()});$("form").on("click",".bloc-panel--sauvegarde",function(){bloc=$(this).closest(".field-bloc");formulaire=$(this).closest(".bloc-panel");formulaire.addClass("hidden");bloc.removeClass("bloc-formulairefocus bloc-optionsAffichagefocus");formulaire.find("input").each(function(){if($(this).attr("type")!=="checkbox"&&$(this).attr("type")!=="radio"){$(this).attr("value",$(this).val())}else{$(this).attr("checked",$(this).prop("checked"))}});tinyMCE.triggerSave();formulaire.find("textarea").each(function(){$(this).html($(this).val())});formulaire.find("select option").each(function(){$(this).attr("selected",$(this).prop("selected"))});formulaireTemporaire=""});$("form").on("click",".bloc-formulaire--sauvegarde",function(){conteneurApercu=$(this).closest(".bloc-formulaire").prev(".bloc-apercu");idBloc=$(this).closest(".contenu").data("bloc");typeBloc=$(this).closest(".bloc-formulaire").data("type");contenu="";tinyMCE.triggerSave();$(this).closest(".bloc-panel").find("input").each(function(){if($(this).attr("type")!=="checkbox"||$(this).attr("type")!=="radio"||$(this).attr("checked")){contenu=contenu===""?contenu+$(this).serialize():contenu+"&"+$(this).serialize()}});$(this).closest(".bloc-panel").find("textarea").each(function(){contenu=contenu===""?contenu+$(this).serialize():contenu+"&"+$(this).serialize()});$(this).closest(".bloc-panel").find("select").each(function(){contenu=contenu===""?contenu+$(this).serialize():contenu+"&"+$(this).serialize()});$.ajax({url:"/admin/bloc/apercuBloc",method:"post",data:{contenu:contenu,idBloc:idBloc,typeBloc:typeBloc}}).done(function(data){conteneurApercu.html(data);lazyLoadInstance.update()}).fail(function(){})});$("form").on("click",".bloc-panel--annulation",function(){bloc=$(this).closest(".field-bloc");formulaire=$(this).closest(".bloc-panel");bloc.removeClass("bloc-formulairefocus bloc-optionsAffichagefocus");formulaire.addClass("hidden").html(formulaireTemporaire).find(".mce-container").remove();formulaireTemporaire="";tinymce.remove();tinymce.init(optionsTinyMCEParagraphe);tinymce.init(optionsTinyMCE);lazyLoadInstance.update();if($(this).hasClass("bloc-optionsAffichage--annulation")){alignementHorizontal=formulaire.find('input[name$="[alignementHorizontal]"]:checked').val();bloc.removeClass("mrauto mlauto").addClass(alignementHorizontal);alignementVertical=formulaire.find('input[name$="[alignementVertical]"]:checked').val();bloc.removeClass("mtauto mbauto").addClass(alignementVertical);alignementHorizontalEnfants=formulaire.find('input[name$="[alignementHorizontalEnfants]"]:checked').val();bloc.children("div").children(".contenu").children(".blocsEnfants").children("div").css("justify-content",alignementHorizontalEnfants);alignementVerticalEnfants=formulaire.find('input[name$="[alignementVerticalEnfants]"]:checked').val();bloc.children("div").children(".contenu").children(".blocsEnfants").children("div").css("align-items",alignementVerticalEnfants);gouttieres=formulaire.find('select[name$="[gouttieres]"]').val();bloc.children("div").children(".contenu").children(".blocsEnfants").children("div").removeClass("gouttieres-s gouttieres-m gouttieres-l gouttieres-").addClass("gouttieres-"+gouttieres);pleineLargeur=formulaire.find('input[name$="[pleineLargeur]"]').prop("checked");pleineLargeur?bloc.addClass("pleineLargeur"):bloc.removeClass("pleineLargeur");padding=formulaire.find('input[name$="[padding]"]').val();bloc.removeClass("pan pas pam pal ptn pts ptm ptl prn prs prm prl pbn pbs pbm pbl pln pls plm pll").addClass(padding)}});$("form").on("click",".monterBloc",function(e){e.preventDefault();$(this).closest("div").removeClass("actif");bloc=$(this).closest(".field-bloc");blocPrecedent=bloc.prev(".field-bloc");bloc.insertBefore(blocPrecedent);tinymce.remove();tinymce.init(optionsTinyMCEParagraphe);tinymce.init(optionsTinyMCE);lazyLoadInstance.update();$(".field-bloc").each(function(){$(this).find("input[id$='position']").val($(this).index())})});$("form").on("click",".descendreBloc",function(e){e.preventDefault();$(this).closest("div").removeClass("actif");bloc=$(this).closest(".field-bloc");blocSuivant=bloc.next(".field-bloc");bloc.insertAfter(blocSuivant);tinymce.remove();tinymce.init(optionsTinyMCEParagraphe);tinymce.init(optionsTinyMCE);lazyLoadInstance.update();$(".field-bloc").each(function(){$(this).find("input[id$='position']").val($(this).index())})});creationFormulaireTemporaire=function(bouton,classFormulaire){$(".bloc-optionsAffichagefocus").removeClass("bloc-optionsAffichagefocus");$(".bloc-formulairefocus").removeClass("bloc-formulairefocus");$(".bloc-optionsAffichage").addClass("hidden");$(".bloc-panel.bloc-formulaire").addClass("hidden");bloc=bouton.closest(".field-bloc");bloc.addClass(classFormulaire+"focus");formulaire=bloc.children("div").children("."+classFormulaire);formulaire.removeClass("hidden");formulaireTemporaire=formulaire.html()};$("form").on("click",".bloc-edit",function(e){e.preventDefault();creationFormulaireTemporaire($(this),"bloc-formulaire")});$("form").on("click",".optionsAffichage",function(e){e.preventDefault();creationFormulaireTemporaire($(this),"bloc-optionsAffichage")});$("form").on("click",".supprimerBloc",function(e){e.preventDefault();e.stopPropagation();$(this).next("div").show()});$("form").on("click",".suppressionBloc-annuler",function(e){e.preventDefault();$(this).closest(".suppressionBloc").hide().closest(".bloc-menu").removeClass("actif")});$("form").on("click",".suppressionBloc-supprimer",function(e){e.preventDefault();if(count===0){entite=$("#main > form").attr("name");count=$("#"+entite+"_blocs").find(".field-bloc").length}$(this).closest(".field-bloc").fadeTo(500,0,function(){$(this).slideUp(300,function(){$(this).remove()});saveCloseFormulaire()})});$("form").on("click",".suppressionBlocAnnexe-supprimer",function(e){e.preventDefault();if(count===0){count=$("#page_active_blocsAnnexes").find(".field-bloc_annexe").length}$(this).closest(".field-bloc_annexe").fadeTo(500,0,function(){$(this).slideUp(300,function(){$(this).remove()});saveCloseFormulaire()});type=$(this).closest(".field-bloc_annexe").find(".type input").val();$("#"+type).removeClass("disabled")});$("form").on("click",".ajoutListeBlocPartage",function(){idBloc=$(this).closest(".field-bloc").children("div").children(".contenu").data("bloc");if(!idBloc){messageFlash("erreur","Ce bloc n'a pas encore été enregistré, et ne peut donc être ajouté à la liste des blocs partagés. Essayez de rafraichir la page.");return}$('#formulaireAjoutListeBlocPartage input[name="idBloc"]').val(idBloc)});$("#formulaireAjoutListeBlocPartage").submit(function(e){e.preventDefault();$.ajax({url:$(this).attr("action"),method:"post",data:$(this).serialize()}).done(function(){$("#ajoutListeBlocPartage").fadeOut("slow",function(){$("#ajoutListeBlocPartage").css("opacity",0);$("#nomBlocPartage").val("")});bloc=$('[data-bloc="'+$('#formulaireAjoutListeBlocPartage input[name="idBloc"]').val()+'"]').closest(".field-bloc");bloc.find(".ajoutListeBlocPartage").addClass("hidden");bloc.find(".suppressionListeBlocPartage").removeClass("hidden");messageFlash("enregistrement","Le bloc a été ajouté à la liste des blocs partagés")})});$("form").on("click",".suppressionListeBlocPartage",function(){idBloc=$(this).closest(".field-bloc").children("div").children(".contenu").data("bloc");$("#suppressionListeBlocPartage").attr("data-bloc",idBloc)});$(".suppressionListeBlocPartage-annulation").click(function(){$(this).closest(".modal-box").fadeOut("fast")});$(".suppressionListeBlocPartage-confirmation").click(function(){idBloc=$(this).closest(".modal-box").attr("data-bloc");$.ajax({url:"/admin/blocPartage/suppressionListe",method:"post",data:{idBloc:idBloc}}).done(function(){$("#suppressionListeBlocPartage").fadeOut("slow");bloc=$('[data-bloc="'+idBloc+'"]').closest(".field-bloc");bloc.find(".ajoutListeBlocPartage").removeClass("hidden");bloc.find(".suppressionListeBlocPartage").addClass("hidden");messageFlash("enregistrement","Le bloc a été retiré de la liste des blocs partagés")})});ajoutBloc=function(type,typeBlocPartage){$(listeBlocs).find(".listeBlocsDnD-bloc").each(function(){cible=$(this);entite=$(".listeBlocsDnD-bloc").closest("form").attr("name");$.ajax({url:Routing.generate("ajouterBloc"),method:"post",data:{type:type,typeBloc:"Bloc",idBlocPartage:idBlocPartage,typeBlocPartage:typeBlocPartage}}).done(function(data){$("div[id^=nvBloc]").attr("id","");saveCloseFormulaire();blocEnfant=cible.closest(".blocsEnfants").length>0;if(blocEnfant){largeurColonne=cible.closest(".blocsEnfants").width()/12}else{largeurColonne=$(".conteneurBlocs > .dndBlocs").width()/12}largeurElement=Math.round(cible.width()/largeurColonne);if(!blocEnfant){if(count===0){count=$("#"+entite+"_blocs").find(".field-bloc").length}else{count++}var form=data.replace(/bloc_/g,entite+"_blocs_"+count+"_").replace(/bloc\[/g,entite+"[blocs]["+count+"][");bloc='<div id="nvBloc'+count+'" class="form-group field-bloc nvBloc col'+largeurElement+" bloc-"+type.toLowerCase()+'" data-name="'+count+'">'+form+"</div>";cible.replaceWith(bloc);nvBloc=$("#nvBloc"+count);nvBloc.resizable(optionsResizable).resizable("option","maxWidth",992)}else{section=cible.closest(".dndBlocs");idSection=section.attr("id");count=section.closest(".field-bloc").data("name");countBloc=section.children(".field-bloc").length;exp=entite+"["+idSection.replace(entite+"_","").replace(/_/g,"][")+"]";var form=data.replace(/bloc_/g,idSection+"_"+countBloc+"_").replace(/bloc\[/g,exp+"["+countBloc+"][");bloc='<div id="nvBloc'+countBloc+'" class="form-group field-bloc col'+largeurElement+" bloc-"+type.toLowerCase()+'" data-name="'+countBloc+'">'+form+"</div>";cible.replaceWith(bloc);nvBloc=$("#nvBloc"+countBloc);nvBloc.children("div").children(".bloc-optionsAffichage").find('input[name$="[pleineLargeur]"]').closest(".form-group").addClass("hidden");nvBloc.resizable(optionsResizable).resizable("option","maxWidth",null)}nvBloc.find('input[name$="[largeur]"]').val("col"+largeurElement);if(type!=="BlocPartage"){nvBloc.addClass("bloc-formulairefocus");nvBloc.find(".bloc-panel.bloc-formulaire").removeClass("hidden")}if(typeBlocPartage==="dissocie"){nvBloc.removeClass("bloc-blocpartage").addClass("bloc-"+nvBloc.find('input[name$="[type]"]').val().toLowerCase())}nvBloc.find('input[name$="[padding]"]').each(function(){verifPadding($(this))});calculCol(nvBloc);nvBloc.find(".field-bloc").each(function(){calculCol($(this))});$(".field-bloc").each(function(){$(this).find("input[id$='position']").val($(this).index())});tinymce.remove();tinymce.init(optionsTinyMCEParagraphe);tinymce.init(optionsTinyMCE);$(".select-multiple").select2();$("#page_active_blocs").sortable(options);$("#region_blocs").sortable(options);$("div[id$='blocsEnfants']").sortable(options);lazyLoadInstance.update()}).fail(function(){cible.remove()})})};$("#ajoutBlocPartageAssocie").click(function(){$(this).closest(".modal-box").fadeOut("slow",function(){$("#ajoutBlocPartage").css("opacity",0)});ajoutBloc("BlocPartage","associe")});$("#ajoutBlocPartageDissocie").click(function(){$(this).closest(".modal-box").fadeOut("slow",function(){$("#ajoutBlocPartage").css("opacity",0)});ajoutBloc("BlocPartage","dissocie")});$(".conteneurBlocs").on("click",".bloc-blocPartager-dissocier",function(){idBlocPartage=$(this).closest(".bloc-blocPartage-edition").find('input[name$="[blocPartage]"]').val();$(this).closest(".field-bloc").replaceWith('<div class="dndPlaceholder listeBlocsDnD-bloc"></div>');ajoutBloc("BlocPartage","dissocie")});$(".listeBlocsAnnexes li").click(function(){if(!$(this).hasClass("disabled")){btnAjoutBloc=$(this);type=$(this).attr("id");$(".listeBlocsAnnexes").addClass("chargement");$.ajax({url:Routing.generate("ajouterBloc"),method:"post",data:{type:type,typeBloc:"BlocAnnexe"}}).done(function(data){saveCloseFormulaire();$(".listeBlocsAnnexes").removeClass("actif chargement");if(count===0){count=$("#page_active_blocsAnnexes").find(".field-bloc_annexe").length}else{count++}var form=data.replace(/bloc_annexe_/g,"page_active_blocsAnnexes_"+count+"_").replace(/bloc_annexe\[/g,"page_active[blocsAnnexes]["+count+"][");bloc='<div id="nvBlocAnnexe'+count+'" class="form-group field-bloc_annexe nvBloc">'+form+"</div>";if($(".listeBlocsAnnexes").attr("id")==="apres"){$("#page_active_blocsAnnexes").append(bloc)}else{$("#page_active_blocsAnnexes").prepend(bloc)}$(".field-bloc_annexe").removeClass("focus");nvBloc=$("#nvBlocAnnexe"+count);nvBloc.addClass("focus");var elOffset=nvBloc.offset().top;var elHeight=nvBloc.height();var windowHeight=$(window).height();if(elHeight<windowHeight){offset=elOffset-(windowHeight/2-elHeight/2)}else{offset=elOffset}$("body, html").animate({scrollTop:offset},600,"swing",function(){nvBloc.fadeTo(600,1)});$("#page_active_blocsAnnexes").prev(".empty").remove();$(".field-blocAnnexe").each(function(){$(this).find("input[id$='position']").val($(this).index())});tinymce.remove();tinymce.init(optionsTinyMCEParagraphe);tinymce.init(optionsTinyMCE);$("#"+type).addClass("disabled")}).fail(function(){$(".listeBlocsAnnexes").removeClass("actif chargement")})}});$(".listeBlocsAnnexes-fermeture").click(function(){$(".listeBlocsAnnexes").removeClass("actif");$(".voirBlocs").removeClass("hidden")});$(".bloc-groupeblocs-edition select").on("change",function(){$(this).next("a").attr("href",Routing.generate("admin",{action:"edit",entity:"GroupeBlocs",id:$(this).val()}))});$("#page_active_blocs, #region_blocs, #page_active_blocsAnnexes").on("click",".field-bloc",function(){if(!$(this).hasClass("focus")){$(".field-bloc").removeClass("focus");$(this).addClass("focus")}});$("#page_active_blocs, #region_blocs, #page_active_blocsAnnexes").on("click",".field-bloc_annexe",function(){if(!$(this).hasClass("focus")){$(".field-bloc_annexe").removeClass("focus");$(this).addClass("focus")}});$(".conteneurBlocs").on("change",'.bloc-formulaire select[id$="type"]',function(){if($(this).val()==="select"||$(this).val()==="radio"||$(this).val()==="checkbox"){$(this).closest("div").siblings(".field-choix").slideDown()}else{$(this).closest("div").siblings(".field-choix").slideUp().find('div[id$="choix"]').remove()}});$(".conteneurBlocs").on("change",'input[id$="_active"]',function(){if($(this).prop("checked")){$(this).closest(".field-bloc").removeClass("desactive")}else{$(this).closest(".field-bloc").addClass("desactive")}});get=parseURLParams(location.href);if(get.blocActif){$(".conteneurBlocs .contenu").not('[data-bloc="'+get.blocActif[0]+'"]').addClass("hide");bloc=$('[data-bloc="'+get.blocActif[0]+'"]');bloc.closest(".field-bloc").addClass("focus");var elOffset=bloc.offset().top;var elHeight=bloc.height();var windowHeight=$(window).height();if(elHeight<windowHeight){offset=elOffset-(windowHeight/2-elHeight/2)}else{offset=elOffset}$("body, html").animate({scrollTop:offset-100},600,"swing")}$(".listeBlocsAnnexes li").click(function(e){e.stopPropagation();$(this).siblings("li.blocCache").addClass("hidden");$(".voirBlocs").removeClass("hidden")});$(".listeBlocsAnnexes").click(function(){$(this).removeClass("actif");$(this).find("li.blocCache").addClass("hidden");$(".voirBlocs").removeClass("hidden");$(".conteneurBlocs > .dndBlocs .ajoutBloc").remove()});$("body").on("change",'input[name$="[typeLien]"]',function(){conteneur=$(this).closest(".lien-page");if($(this).val()==="page"||$(this).val()==="autre"){conteneur.find(".lien-page--blank").removeClass("hidden");if($(this).val()==="page"){conteneur.find(".page").removeClass("hidden");conteneur.find(".autre").addClass("hidden").find("input").val("")}else{conteneur.find(".page").addClass("hidden").find("select").val("");conteneur.find(".autre").removeClass("hidden")}}else{conteneur.find(".page").addClass("hidden").find("select").val("");conteneur.find(".autre").addClass("hidden").find("input").val("");conteneur.find(".lien-page--blank").addClass("hidden")}conteneur.find(".lien-page--blank").find("input").prop("checked",false)});$('input[name$="[typeLien]"]').each(function(){conteneur=$(this).closest(".lien-page");if($(this).prop("checked")&&$(this).val()==="page"){conteneur.find(".page").removeClass("hidden");conteneur.find(".lien-page--blank").removeClass("hidden")}else if($(this).prop("checked")&&$(this).val()==="autre"){conteneur.find(".autre").removeClass("hidden");conteneur.find(".lien-page--blank").removeClass("hidden")}});$("body").on("change",".case-choix input",function(){conteneur=$(this).closest(".field-case");if($(this).val()==="page"){conteneur.find(".case-page").removeClass("hidden");conteneur.find(".case-autre").addClass("hidden")}else{conteneur.find(".case-page").addClass("hidden");conteneur.find(".case-autre").removeClass("hidden")}});$(".case-choix input").each(function(){conteneur=$(this).closest(".field-case");if($(this).prop("checked")&&$(this).val()==="page"){conteneur.find(".case-page").removeClass("hidden")}else if($(this).prop("checked")&&$(this).val()==="autre"){conteneur.find(".case-autre").removeClass("hidden")}});$("body").on("keyup",'.bloc-video input[name$="[video]"]',function(){urlVideo=$(this).val();if(urlVideo.includes("youtube")||urlVideo.includes("youtu.be")){if(urlVideo.includes("?v=")){urlVideo=urlVideo.split("?v=").pop()}else{urlVideo=urlVideo.split("/").pop()}urlVideo="https://www.youtube.com/embed/"+urlVideo+"?rel=0"}$(this).closest(".contenu").find("iframe").show().attr("src",urlVideo)});$(".voirBlocs").click(function(e){e.stopPropagation();$(this).addClass("hidden");$(this).prev("ul").find(".blocCache").removeClass("hidden")});$("body").on("change",'input[name$="[alignementHorizontal]"]',function(){$(this).closest(".field-bloc").removeClass("mrauto mlauto").addClass($(this).val())});$("body").on("change",'input[name$="[alignementVertical]"]',function(){$(this).closest(".field-bloc").removeClass("mtauto mbauto").addClass($(this).val())});$("body").on("change",'input[name$="[alignementHorizontalEnfants]"]',function(){$(this).closest(".field-bloc").children("div").children(".contenu").children(".blocsEnfants").children("div").css("justify-content",$(this).val())});$("body").on("change",'input[name$="[alignementVerticalEnfants]"]',function(){$(this).closest(".field-bloc").children("div").children(".contenu").children(".blocsEnfants").children("div").css("align-items",$(this).val())});$("body").on("change",'select[name$="[gouttieres]"]',function(){$(this).closest(".field-bloc").children("div").children(".contenu").children(".blocsEnfants").children("div").removeClass("gouttieres-s gouttieres-m gouttieres-l gouttieres-").addClass("gouttieres-"+$(this).val())});$("body").on("change",'input[name$="[pleineLargeur]"]',function(){if($(this).prop("checked")){$(this).closest(".field-bloc").addClass("pleineLargeur").resizable("option","disabled",true);$(this).closest(".field-bloc").find("field-bloc").resizable("option","disabled",false).resizable("option","maxWidth",null)}else{$(this).closest(".field-bloc").removeClass("pleineLargeur").resizable("option","disabled",false).resizable("option","maxWidth",992)}$(this).closest(".field-bloc").removeClass("col12 col11 col10 col9 col8 col7 col6 col5 col4 col3 col2 col1").addClass("col12");$(this).closest(".bloc-panel").find('input[name$="[largeur]"]').val("col12")});$("body").on("click",".togglePadding",function(){blocPadding=$(this).closest("div").next(".bloc-padding");input=$(this).closest("div").siblings('input[name$="[padding]"]');selectTout=$(this).prev("select");if(blocPadding.hasClass("hidden")){nouvelleVal="";blocPadding.find("select").each(function(){nouvelleVal+=$(this).val()+" "});input.val(nouvelleVal);selectTout.attr("disabled",true)}else{input.val(selectTout.val());selectTout.attr("disabled",false)}$(this).find("svg").toggleClass("fa-link fa-unlink");blocPadding.toggleClass("hidden")});$("body").on("change",'select[name$="[paddingTout]"]',function(){input=$(this).closest("div").siblings('input[name$="[padding]"]');input.val($(this).val()).trigger("change")});$("body").on("change",'select[name$="[paddingGauche]"], select[name$="[paddingDroit]"], select[name$="[paddingHaut]"], select[name$="[paddingBas]"]',function(){input=$(this).closest(".bloc-padding").siblings('input[name$="[padding]"]');nouvelleVal="";$(this).closest(".bloc-padding").find("select").each(function(){nouvelleVal+=$(this).val()+" "});input.val(nouvelleVal).trigger("change")});$("body").on("change",'input[name$="[padding]"]',function(){$(this).closest(".field-bloc").removeClass("pan pas pam pal ptn pts ptm ptl prn prs prm prl pbn pbs pbm pbl pln pls plm pll").addClass($(this).val())});verifPadding=function(champPadding){padding=champPadding.val().split(" ");if(padding[0]!==""){bloc=champPadding.closest(".field-bloc");equivalencePadding={pa:"paddingTout",pt:"paddingHaut",pr:"paddingDroit",pb:"paddingBas",pl:"paddingGauche"};if(padding.length>1){togglePadding=bloc.find(".togglePadding");togglePadding.prev("select").attr("disabled",true);togglePadding.find("svg").toggleClass("fa-link fa-unlink");bloc.find(".bloc-padding").toggleClass("hidden")}padding.forEach(function(item){typePadding=item.substr(0,2);bloc.find('select[name$="['+equivalencePadding[typePadding]+']"]').val(item)})}};$('.field-bloc input[name$="[padding]"]').each(function(){verifPadding($(this))});$("body").on("change",'input[name$="[typeRS]"]',function(){conteneur=$(this).closest(".contenu");if($(this).val()==="partage"){conteneur.find(".rs-input-partage").removeClass("hidden");conteneur.find(".rs-input-liens").addClass("hidden")}else{conteneur.find(".rs-input-partage").removeClass("hidden");conteneur.find(".rs-input-liens").removeClass("hidden")}});$("#toggleMiseEnPage").click(function(){$(this).closest(".conteneurBlocs").toggleClass("miseEnPage")});$("#toggleListeBlocsDnD").click(function(){$(this).closest(".conteneurBlocs").toggleClass("affichagelisteBlocsDnD");$(".listeBlocsDnD").toggle()});$("body").on("change",'input[name*="[utiliserFluxSpecifique]"]',function(){$(this).closest(".form-group").next("div").slideToggle()});$("body").on("change",'.bloc-lei input[name$="[recherche]"]',function(){if($(this).val()==="criteres"){$(this).closest(".form-group").next("div").slideDown()}else{$(this).closest(".form-group").next("div").slideUp()}});$("body").on("keyup change",'input[name$="[fluxGenerique]"], input[name*="[utiliserFluxSpecifique]"], input[name$="[flux]"], input[name$="[clause]"], input[name$="[autresParametres]"]',function(){blocLEI=$(this).closest(".bloc-lei");if(blocLEI.find('input[name*="[utiliserFluxSpecifique]"]').is(":checked")&&blocLEI.find('input[name$="[flux]"]').val()!==""){nvUrlFlux=blocLEI.find('input[name$="[flux]"]').val()}else{nvUrlFlux=blocLEI.find('input[name$="[fluxGenerique]"]').val()}nvUrlFlux+="&clause="+blocLEI.find('input[name$="[clause]"]').val()+blocLEI.find('input[name$="[autresParametres]"]').val();blocLEI.find(".voirFlux").attr("href",nvUrlFlux)});$("body").on("click",".viderCacheLEI",function(e){e.preventDefault();$.ajax({type:"POST",url:"/admin/LEI/viderCache",success:function(){messageFlash("enregistrement","Les fichiers de cache LEI ont été vidés")}})})});