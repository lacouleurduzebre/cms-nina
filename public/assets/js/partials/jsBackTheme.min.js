$(document).ready(function(){$(".theme-actions").on("click",".installation-theme",function(){lien=$(this).closest(".theme-actions").data("lien");nom=$(this).closest(".theme-actions").data("nom");bouton=$(this);blocTheme=$("#"+nom);$("#"+nom+" .theme-messages").css("display","flex");$("#"+nom+" .loader").show();$.ajax({url:Routing.generate("installerTheme"),method:"post",data:{lien:lien,nom:nom}}).done(function(){$("#"+nom+" .loader").hide();$("#"+nom+" .message-ok").empty().append('<i class="fas fa-check-circle"></i>Le thème a été installé').fadeIn().delay(800).fadeOut();bouton.hide();bouton.siblings(".activation-theme").show();bouton.siblings(".desinstallation-theme").show();setTimeout(function(){$("#"+nom+" .theme-messages").hide();blocTheme.appendTo(".themesInstalles")},1600)}).fail(function(){$("#"+nom+" .message-fail").fadeIn().delay(800).fadeOut()})});$(".theme-actions").on("click",".activation-theme",function(){theme=$(this).closest(".theme-actions").data("nom");nom=$(this).closest(".theme-actions").data("nom");bouton=$(this);blocTheme=$("#"+nom);$("#"+nom+" .theme-messages").css("display","flex");$("#"+nom+" .loader").show();$.ajax({url:Routing.generate("changerTheme"),method:"post",data:{theme:theme}}).done(function(){$("#"+nom+" .loader").hide();$("#"+nom+" .message-ok").empty().append('<i class="fas fa-check-circle"></i>Le thème a été activé').fadeIn().delay(800).fadeOut();nomAncienTheme=$(".theme.actif").attr("id");$(".theme.actif").find(".activation-theme").show();lien=$(".theme.actif").find(".theme-actions").data("lien");if(typeof lien!==typeof undefined&&lien!==false){$(".theme.actif").find(".desinstallation-theme").show()}$(".theme").removeClass("actif");$("#"+theme).addClass("actif");bouton.hide();bouton.siblings(".desinstallation-theme").hide();setTimeout(function(){$("#"+nom+" .theme-messages").hide()},1600)}).fail(function(){$("#"+nom+" .message-fail").fadeIn().delay(800).fadeOut()})});$(".theme-actions").on("click",".desinstallation-theme",function(){nom=$(this).closest(".theme-actions").data("nom");lien=$(this).closest(".theme-actions").data("lien");bouton=$(this);blocTheme=$("#"+nom);$("#"+nom+" .theme-messages").css("display","flex");$("#"+nom+" .loader").show();$.ajax({url:"/admin/theme/desinstaller",method:"post",data:{nom:nom}}).done(function(data){$("#"+nom+" .loader").hide();$("#"+nom+" .message-ok").empty().append('<i class="fas fa-check-circle"></i>Le thème a été désinstallé').fadeIn().delay(800).fadeOut();bouton.hide();bouton.siblings(".activation-theme").hide();bouton.siblings(".installation-theme").show();setTimeout(function(){$("#"+nom+" .theme-messages").hide();blocTheme.appendTo(".themesDisponibles")},1600)}).fail(function(){$("#"+nom+" .message-fail").fadeIn().delay(800).fadeOut()})});$('input[type="color"]').change(function(){couleur=$(this).val();$('.echantillonCouleur[data-champ="'+$(this).attr("name")+'"]').css("background-color",couleur)});$(".elementParametrable").click(function(e){e.preventDefault();$(".elementParametrable").not(this).removeClass("actif");parametres=$(this).data("parametres");$(".parametres").not("."+parametres).hide();$(this).toggleClass("actif");$(".parametres."+parametres).toggle()});dec2hex=function(i){var hex="00";if(i>=0&&i<=15){hex="0"+i.toString(16)}else if(i>=16&&i<=255){hex=i.toString(16)}return hex};selectionCouleur=function(e){var x,y;var c=$(".parametrageTheme-selectionCouleur canvas").get(0);var cxt=c.getContext("2d");if(e.pageX||e.pageY){x=e.pageX;y=e.pageY}else{x=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;y=e.clientY+document.body.scrollTop+document.documentElement.scrollTop}var element=c.offsetParent;while(element!==null){x=parseInt(x)-parseInt(element.offsetLeft);y=parseInt(y)-parseInt(element.offsetTop);element=element.offsetParent}x-=c.offsetLeft;y-=c.offsetTop;var cData=cxt.getImageData(x,y,3,3).data;var mr=Math.round((cData[0]+cData[4]+cData[8]+cData[12]+cData[16]+cData[20]+cData[24]+cData[28]+cData[32])/9);var mg=Math.round((cData[1]+cData[5]+cData[9]+cData[13]+cData[17]+cData[21]+cData[25]+cData[29]+cData[33])/9);var mb=Math.round((cData[2]+cData[6]+cData[10]+cData[14]+cData[18]+cData[22]+cData[26]+cData[30]+cData[34])/9);var hex=dec2hex(mr)+dec2hex(mg)+dec2hex(mb);selecteur=e.type==="click"?"Selectionnee":"Survolee";$(".parametrageTheme-couleur"+selecteur+" .echantillon").css("background-color","#"+hex);$(".parametrageTheme-couleur"+selecteur+" .codeHexa").html("#"+hex);$(".parametrageTheme-couleur"+selecteur+" .codeRGB").html("RGB ("+mr+","+mg+","+mb+")")};if($(".parametrageTheme-logo").length>0){image=$(".parametrageTheme-logo").get(0);var canvas=document.createElement("canvas");imageWidth=image.width;while(imageWidth===0){setTimeout(function(){imageWidth=image.width},500)}canvas.width=image.width;canvas.height=image.height;canvas.getContext("2d").drawImage(image,0,0);$(".parametrageTheme-selectionCouleur").prepend(canvas);$(".parametrageTheme-selectionCouleur canvas").on("mousemove click",function(e){selectionCouleur(e)})}});